<html>
<head>
  <meta charset="utf-8">
  <!--<meta http-equiv="refresh" content="22" > -->

  <!--ADD ALL CSS STYLE-SHEETS -->

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/css/materialize.min.css">
  {% assets "main_css" %}

  <link rel=stylesheet type=text/css href="{{ASSET_URL}}">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  {%endassets%}

  <!--ADD ALL JAVASCRIPTS ##BUNDLED INTO ONE FILE-->

  {% assets "main_js" %}

  <script type="text/javascript" src="{{ASSET_URL}}" > </script>
  <script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="q35o4p01rr1byor"></script>

  {%endassets%}


</head>
<body>

<nav>
<div class="nav-wrapper grey lighten-5">
    <p class="grey-text text-darken-4">
<i class="fas fa-file-archive fa-3x"> Compress it!</i>

</p>
</div>

</nav>

<div class="row">
   <!-- <div class="col s12 m4 l2"><h3>Compress it online</h3></div> -->
   <div class="col s12"><p></p></div>
   <div class="col s12 m4 l2"></div>

   <div class="col s12 m4 l10">
     <div  id="drop-zone">
       <div class="row">
         <div class="col s12 m6 l10">
           <div class="card blue-grey darken-1">
             <div class="card-content white-text">
               <span class="card-title">
                 <i class="fas fa-file-medical fa-2x"> </i>
                 Compress Dicom Files
               </span>
               <form class="uploadform"  name="upload" method="POST" action="{{ url_for('downloader') }}" enctype = "multipart/form-data">

                 </div>

               <button disabled type="submit"  name="submit" class="btn-floating halfway-fab waves-effect waves-light red" id="js-upload-submit">
                 <i class="fas fa-file-download"> </i>

               </button>

                 </form>

               <div  id="drop-zone">
               <form class="dropzone dz-clickable" id="mydropzone" name='file' action="{{ url_for('uploader') }}" enctype = "multipart/form-data">
               <span>

               <i id="auth" class="fab fa-dropbox " onclick="Dropbox.choose(options)" style="color:rgb(0,0,0)" onchange="Button_Enable()">Dropbox</i> </g>

               </span>

               <span>
               <br/>
               <br/>
               <i id="pick" class="fab fa-google-drive " onclick="newPicker()" style="color:rgb(0,0,0)">Google Drive</i>

               </span>

<!-- PROGRESS BAR -->
               <!-- <div class="progress" style="width: 50%; margin: 50px;">
                 <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                   <span class="progress-bar-label">0%</span>
                 </div>
               </div> -->

               </form>

             </div>
              <div class="card-action">



             </div>
           </div>
         </div>
       </div>
      </div>

     </div>

  </div>

  <script>
  Button_Enable(){
  $("#js-upload-submit").removeAttr('disabled');
  $("#js-upload-submit").css({
    "cursor": "pointer",
    "box-shadow": "1px 0px 6px #333"
  });}
  </script>
<script>
$.ajax({
          url: '/uploader',
          type: 'GET',
          dataType: 'json',
          data: {key: 'success'},
          success:function(json)
          {
                        $("#js-upload-submit").removeAttr('disabled');
                        $("#js-upload-submit").css({
                          "cursor": "pointer",
                          "box-shadow": "1px 0px 6px #333"
                        });

          }

        });
</script> 






<script>

options = {

    // Required. Called when a user selects an item in the Chooser.
    success: function(files) {

      var link=files[0].link
      $.ajax({
  type: "POST",
  contentType: "application/json;charset=utf-8",
  url: "/uploader",
  traditional: "true",
  data: JSON.stringify({link}),
  dataType: "json"
  });
        //alert("Here's the file link: "+ files[0].link )
    },

    // Optional. Called when the user closes the dialog without selecting a file
    // and does not include any parameters.
    cancel: function() {

    },

    // Optional. "preview" (default) is a preview link to the document for sharing,
    // "direct" is an expiring link to download the contents of the file. For more
    // information about link types, see Link types below.
    linkType: "direct", // or "preview"

    // Optional. A value of false (default) limits selection to a single file, while
    // true enables multiple file selection.
    multiselect: false, // or true

    // Optional. This is a list of file extensions. If specified, the user will
    // only be able to select files with these extensions. You may also specify
    // file types, such as "video" or "images" in the list. For more information,
    // see File types below. By default, all extensions are allowed.
    extensions: ['.dcm'],

    // Optional. A value of false (default) limits selection to files,
    // while true allows the user to select both folders and files.
    // You cannot specify `linkType: "direct"` when using `folderselect: true`.
    folderselect: false, // or true
};



</script>


	<script src="static/filepicker.js"></script>
	<script>
		function initPicker() {
			var picker = new FilePicker({
				apiKey: 'AIzaSyDTpfIEYydGLzzhKRrm41LaqFssZLiqsjU',
				clientId:'358327259908-80kme5hvb18pajeh2ujtb727cue6fc87.apps.googleusercontent.com',
				buttonEl: document.getElementById('pick'),
				onSelect: function(file) {
					console.log(file);
					//alert('Selected ' + file.downloadUrl);
          var link=file.webContentLink
          var met="drive"
          $.ajax({
      type: "POST",
      contentType: "application/json;charset=utf-8",
      url: "/uploader",
      traditional: "true",
      data: JSON.stringify({link}),
      //data2: JSON.stringify({met}),
      dataType: "json"
      });
				}
			});
		}
	</script>

	<script src="https://www.google.com/jsapi?key=AIzaSyDTpfIEYydGLzzhKRrm41LaqFssZLiqsjU"></script>
<script src="https://apis.google.com/js/client.js?onload=initPicker"></script>




</script>



  <!--  <img src="{{url_for('static', filename='dicom.png')}}" height="250px" width="250px" alt="No files uploaded" style="position:relative;left:10px">


</div>
-->
<script>

</script>

</div>

        <footer class="page-footer grey">
          <div class="container">
            <div class="row">
              <div class="col l6 s12">

                <p class="grey-text text-darken-4">
                  <a class="grey-text text-darken-4" href="{{ url_for('script_download') }}" > Wish to convert it back to .dcm? Download our simple python script</a>
                </p>
                <button type="submit"  name="submit" class="btn waves-effect waves-light" id="js-upload-submit">
                  <i class="fas fa-file-code fa-7x"> Download script</i>

                </button>
              </div>


        </footer>
        <div class="footer-copyright grey">
          <div class="container">
          Â© 2018 Copyright Text
          <a class="grey-text text-darken-4 right" href="#!">More Links</a>
          </div>
        </div>

<!-- SCRIPT FOR PROGRESS BAR -->
        <!-- <script>
      	var source = new EventSource("/uploader");
      	source.onmessage = function(event) {
      		$('.progress-bar').css('width', event.data+'%').attr('aria-valuenow', event.data);
      		$('.progress-bar-label').text(event.data+'%');
      		if(event.data == 100){
      			source.close()
      		}
      	}
      	</script> -->





          <script>/*



              cornerstoneWADOImageLoader.external.cornerstone = cornerstone;

              // this function gets called once the user drops the file onto the div
              function handleFileSelect(evt) {
                  evt.stopPropagation();
                  evt.preventDefault();

                  // Get the FileList object that contains the list of files that were dropped
                  const files = evt.dataTransfer.files;

                  // this UI is only built for a single file so just dump the first one
                  file = files[0];
                  const imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(file);
                  loadAndViewImage(imageId);
              }

              function handleDragOver(evt) {
                  evt.stopPropagation();
                  evt.preventDefault();
                  evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
              }

              // Setup the dnd listeners.
              const dropZone = document.getElementById('mydropzone');
              dropZone.addEventListener('dragover', handleDragOver, false);
              dropZone.addEventListener('drop', handleFileSelect, false);


              cornerstoneWADOImageLoader.configure({
                  beforeSend: function(xhr) {
                      // Add custom headers here (e.g. auth tokens)
                      //xhr.setRequestHeader('x-auth-token', 'my auth token');
                  },
                  useWebWorkers: true,
              });

              let loaded = false;

              function loadAndViewImage(imageId) {
                  const element = document.getElementById('dicomImage');

                  cornerstone.loadImage(imageId).then(function(image) {
                      console.log(image);
                      const viewport = cornerstone.getDefaultViewportForImage(element, image);


                      cornerstone.displayImage(element, image, viewport);
                      if(loaded === false) {
                          cornerstoneTools.mouseInput.enable(element);
                          cornerstoneTools.mouseWheelInput.enable(element);
                          cornerstoneTools.wwwc.activate(element, 1); // ww/wc is the default tool for left mouse button
                          cornerstoneTools.pan.activate(element, 2); // pan is the default tool for middle mouse button
                          cornerstoneTools.zoom.activate(element, 4); // zoom is the default tool for right mouse button
                          cornerstoneTools.zoomWheel.activate(element); // zoom is the default tool for middle mouse wheel


                          loaded = true;
                      }
                    }, function(err) {
                        alert("Seems like uploaded the wrong file");
                    });
                  }
                  cornerstone.events.addEventListener('cornerstoneimageloadprogress', function(event) {
                      const eventData = event.detail;
                      const loadProgress = document.getElementById('loadProgress');
                      loadProgress.textContent = `Image Load Progress: ${eventData.percentComplete}%`;
                  });

                  const element = document.getElementById('dicomImage');
                  cornerstone.enable(element);

                  document.getElementById('file').addEventListener('change', function(e) {
                      // Add the file to the cornerstoneFileImageLoader and get unique
                      // number for that file
                      const file = e.target.files[0];
                      const imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(file);
                      loadAndViewImage(imageId);
                  });
*/
              </script>


</body>

</html>
